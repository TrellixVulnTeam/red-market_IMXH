{"version":3,"file":"videogular-ngx-videogular-modulo.js","sources":["../../libs/ngx-videogular/modulo/src/lib/utils/modulo.ts","../../libs/ngx-videogular/modulo/src/lib/components/vg-modulo.component.ts","../modulo/src/lib/modulo.module.ts","../../libs/ngx-videogular/modulo/src/lib/interfaces/fluctus.interface.ts","../../libs/ngx-videogular/modulo/src/lib/interfaces/modulo-config.interface.ts"],"names":[],"mappings":"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","sourcesContent":["import {FluctusInterface} from '../interfaces/fluctus.interface';\n\nconst AudioContext = window[\"AudioContext\"] || window[\"webkitAudioContext\"];\n\nexport class Gondolo implements FluctusInterface {\n  ctx: AudioContext;\n  analyser: AnalyserNode | Array<AnalyserNode>;\n  stereo: boolean;\n  audible: boolean;\n  wavedata: Uint8Array | null;\n  freqdata: any;\n  splitter: ChannelSplitterNode | null;\n  merger: ChannelMergerNode | null;\n  source: MediaElementAudioSourceNode | MediaStreamAudioSourceNode;\n  output: ChannelMergerNode;\n\n  constructor(\n    audio:\n      | HTMLAudioElement\n      | AudioNode\n      | MediaStream\n      | MediaElementAudioSourceNode\n      | MediaStreamAudioSourceNode,\n    ctx?: AudioContext | any,\n    opts?: { stereo?: boolean; audible?: boolean }\n  ) {\n    if (!(this instanceof Gondolo)) {\n      return new Gondolo(audio, ctx, opts);\n    }\n\n    if (!(ctx instanceof AudioContext)) {\n      (opts = ctx), (ctx = null);\n    }\n\n    opts = opts || {};\n    this.ctx = ctx = ctx || new AudioContext();\n\n    if (!(audio instanceof AudioNode)) {\n      audio =\n        audio instanceof Audio || audio instanceof HTMLAudioElement\n          ? ctx.createMediaElementSource(audio)\n          : ctx.createMediaStreamSource(audio);\n    }\n\n    this.audioConfigStateResolver(ctx, opts, audio);\n    this.audioConfigStateParser(ctx);\n  }\n\n  public waveform(output?: Uint8Array, channel?: number): Uint8Array {\n    if (!output) {\n      output =\n        this.wavedata ||\n        (this.wavedata = new Uint8Array(\n          (this.analyser[0] || this.analyser).frequencyBinCount\n        ));\n    }\n\n    const analyser = this.stereo ? this.analyser[channel || 0] : this.analyser;\n\n    analyser.getByteTimeDomainData(output);\n\n    return output;\n  }\n\n  public frequencies(output?: Uint8Array, channel?: number): Uint8Array {\n    if (!output) {\n      output =\n        this.freqdata ||\n        (this.freqdata = new Uint8Array(\n          (this.analyser[0] || this.analyser).frequencyBinCount\n        ));\n    }\n\n    const analyser = this.stereo ? this.analyser[channel || 0] : this.analyser;\n\n    analyser.getByteFrequencyData(output);\n\n    return output;\n  }\n\n  private audioConfigStateResolver(\n    ctx: AudioContext,\n    opts: { stereo?: boolean; audible?: boolean },\n    audio: MediaElementAudioSourceNode | any\n  ): void {\n    this.analyser = ctx.createAnalyser();\n    this.stereo = !!opts.stereo;\n    this.audible = opts.audible !== false;\n    this.wavedata = null;\n    this.freqdata = null;\n    this.splitter = null;\n    this.merger = null;\n    this.source = audio;\n  }\n\n  private audioConfigStateParser(ctx: AudioContext) {\n    if (!this.stereo) {\n      this.output = this.source;\n\n      this.source.connect(this.analyser[0] || this.analyser);\n\n      if (this.audible) {\n        (this.analyser[0] || this.analyser).connect(ctx.destination);\n      }\n    } else {\n      this.analyser = [this.analyser[0] || this.analyser];\n\n      this.analyser.push(ctx.createAnalyser());\n\n      this.splitter = ctx.createChannelSplitter(2);\n      this.merger = ctx.createChannelMerger(2);\n      this.output = this.merger;\n\n      this.source.connect(this.splitter);\n\n      for (let i = 0; i < 2; i++) {\n        this.splitter.connect(this.analyser[i], i, 0);\n        this.analyser[i].connect(this.merger, 0, i);\n      }\n\n      if (this.audible) {\n        this.merger.connect(ctx.destination);\n      }\n    }\n  }\n}\n","import { Component, ElementRef, Input, ViewChild } from \"@angular/core\";\nimport { ModuloConfig } from '../interfaces/modulo-config.interface';\nimport { Gondolo } from \"../utils/modulo\";\n\n@Component({\n  selector: \"vg-modulo\",\n  templateUrl: \"./vg-modulo.component.html\",\n})\nexport class VgModuloComponent {\n  private _audioAnalyser: Gondolo;\n  private _ctx: CanvasRenderingContext2D;\n\n  @Input() moduloConfig: ModuloConfig;\n  @Input() audioElement: HTMLAudioElement;\n\n  @ViewChild(\"waveCanvas\", { static: false }) waveCanvas: ElementRef<HTMLCanvasElement>;\n\n  public startVisualizer() {\n    if (!this._audioAnalyser) {\n      this._audioAnalyser = new Gondolo(this.audioElement);\n\n      const {width, height} = this.moduloConfig.dimensions;\n      const canvasElement = this.waveCanvas.nativeElement;\n\n      this._ctx = canvasElement.getContext(\"2d\");\n\n      canvasElement.width = width;\n      canvasElement.height = height;\n    }\n\n    this.update();\n  }\n\n  public update() {\n    const audioFreq = this._audioAnalyser.waveform();\n    const {fillStyle, strokeStyle, lineWidth, scaleFactor} = this.moduloConfig;\n    const {width, height} = this.waveCanvas.nativeElement;\n\n    // Clear canvas\n    this._ctx.fillStyle = fillStyle;\n    this._ctx.fillRect(0, 0, width, height);\n\n    this._ctx.strokeStyle = strokeStyle;\n    this._ctx.lineWidth = lineWidth;\n\n    // Draw frequency lines\n    this._ctx.beginPath();\n    this._ctx.moveTo(0, height / 2 - audioFreq[0] * scaleFactor);\n\n    for (let i = 0; i < audioFreq.length; i++) {\n      this._ctx.lineTo(\n        (width / audioFreq.length) * i,\n        height / 2 - audioFreq[i] * scaleFactor\n      );\n    }\n\n    this._ctx.moveTo(0, height / 2 + audioFreq[0] * scaleFactor);\n\n    for (let i = 0; i < audioFreq.length; i++) {\n      this._ctx.lineTo(\n        (width / audioFreq.length) * i,\n        height / 2 + audioFreq[i] * scaleFactor\n      );\n    }\n\n    this._ctx.stroke();\n\n    window.requestAnimationFrame(() => this.update());\n  }\n}\n","import { NgModule } from \"@angular/core\";\nimport { CommonModule } from \"@angular/common\";\nimport { VgModuloComponent } from \"./components/vg-modulo.component\";\n\n@NgModule({\n  imports: [\n    CommonModule\n  ],\n  declarations: [VgModuloComponent],\n  exports: [VgModuloComponent],\n})\nexport class VgModuloModule {}\n","export interface FluctusInterface {\n  ctx: AudioContext;\n  analyser: AnalyserNode | AnalyserNode[];\n  stereo: boolean;\n  audible: boolean;\n  wavedata: Uint8Array | null;\n  freqdata: any;\n  splitter: ChannelSplitterNode | null;\n  merger: ChannelMergerNode | null;\n  source: MediaElementAudioSourceNode | MediaStreamAudioSourceNode;\n  output: ChannelMergerNode;\n  waveform(output?: Uint8Array, channel?: number): Uint8Array;\n  frequencies(output?: Uint8Array, channel?: number): Uint8Array;\n}\n","export interface ModuloConfig {\n  dimensions: {\n    width: number,\n    height: number\n  },\n  fillStyle: string | CanvasGradient | CanvasPattern,\n  strokeStyle: string | CanvasGradient | CanvasPattern,\n  lineWidth: number,\n  scaleFactor: number\n}\n"]}